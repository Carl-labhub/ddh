name: Build and publish ddh Docker image
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/master' # Running this job only for master branch
    steps:
    - uses: actions/checkout@v1
    - name: Build the Docker image
      run: docker build . -t ddh:${GITHUB_SHA}
    - name: Tag as latest
      run: docker tag ddh:${GITHUB_SHA} docker.pkg.github.com/${GITHUB_REPOSITORY}/ddh:latest
    - name: Authenticate to GitHub Docker Registry
      run: docker login -u ${GITHUB_ACTOR} -p ${GITHUB_TOKEN} docker.pkg.github.com
    - name: Publish the Docker image
      run: docker push docker.pkg.github.com/${GITHUB_REPOSITORY}/ddh:latest
